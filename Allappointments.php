<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Appointment Page</title>
  <style>
    body {
      background-color: #f8d0e0;
    }
    textarea {
      width: 100%;
      height: 300px;
      resize: vertical;
    }
    button {
      margin-top: 10px;
    }
 
    table {
      background-color: white;
      border-collapse: collapse;
      width: 100%;
    }
    table th, table td {
      border: 1px solid black;
      padding: 8px;
    }
    table th {
      font-size: 20px;
      color: pink;
    }

    /* Added CSS for message display */
    #message {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #ffffff;
      padding: 20px;
      border: 2px solid #000000;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <h1>Appointment Page</h1>
  <h2>Appointments</h2>

  <table style="background-color: white;">
    <tr>
      <th style="font-size: 20px; color: black;">Service Name</th>
      <th style="font-size: 20px; color: black;">Customer ID</th>
      <th style="font-size: 20px; color: black;">Date</th>
      <th style="font-size: 20px; color: black;">Time</th> <!-- Added Time column -->
      <th style="font-size: 20px; color: black;">Appointment ID</th>
      <th style="font-size: 20px; color: black;">Phone Number</th>
    </tr>
    <?php
    require('db.php');
    // Assuming you have already established a database connection
    $connection = new mysqli($servername, $dbusername, $dbpassword, $dbname);

    // Check connection
    if ($connection->connect_error) {
      die("Connection failed: " . $connection->connect_error);
    }

    // Prepare a statement to fetch appointments
    $query = "SELECT a.service_name, a.customer_id, a.date, a.time, a.ID, u.number FROM appointments AS a INNER JOIN users AS u ON a.customer_id = u.id";
    $statement = $connection->prepare($query);

    // Execute the statement
    $statement->execute();

    // Get result
    $result = $statement->get_result();

    // Check if appointments exist
    if ($result->num_rows > 0) {
      // Iterate through each appointment and create a table row
      while ($row = $result->fetch_assoc()) {
        $service_name = $row['service_name'];
        $customer_id = $row['customer_id'];
        $date = $row['date'];
        $time = $row['time']; // Added time variable
        $ID = $row['ID'];
        $number = $row['number'];
        ?>
        <tr>
          <td><?php echo htmlspecialchars($service_name); ?></td>
          <td><?php echo htmlspecialchars($customer_id); ?></td>
          <td><?php echo htmlspecialchars($date); ?></td>
          <td><?php echo htmlspecialchars($time); ?></td> <!-- Display time -->
          <td><?php echo htmlspecialchars($ID); ?></td>
          <td><?php echo htmlspecialchars($number); ?></td>
        </tr>
        <?php
      }
    } else {
      // Display a table row for no appointments found
      ?>
      <tr>
        <td colspan="6">No appointments found.</td>
      </tr>
      <?php
    }
    ?>
  </table>
 
  <h2>Manage Appointments</h2>
  <button onclick="deleteAppointments()">Delete</button>

  <button onclick="location.href='Admin_homepage.php'">Finish</button> <!-- Added "Finish" button -->

  <!-- Message display div -->
  <div id="message"></div>

  <script>

   
function deleteAppointments() {
        // Prompt the user to enter the ID of the appointment
        var appointmentID = prompt("Enter the ID of the appointment you want to delete:");

        // Check if the user entered an ID
        if (appointmentID !== null && appointmentID !== "") {
            // Send an AJAX request to delete the appointment
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "Adelete_appointment.php", true);
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        var response = JSON.parse(xhr.responseText);
                        alert(response.message); // Display alert message from server
                        if (response.message === "Appointment deleted successfully.") {
                            // Refresh the appointments list after successful deletion
                            location.reload();
                        }
                    } else {
                        alert("Failed to delete appointment. Please try again.");
                    }
                }
            };
            xhr.send("id=" + encodeURIComponent(appointmentID)); // Encode the appointment ID
        }
    }
    // Function to display message
    function showMessage(message) {
      var messageDiv = document.getElementById("message");
      messageDiv.innerHTML = message;
      messageDiv.style.display = "block";
      // Hide the message after 3 seconds
      setTimeout(function() {
        messageDiv.style.display = "none";
      }, 3000);
    }
  </script>
</body>
</html>
